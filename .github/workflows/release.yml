on:
  push:
    branches:
      - master
name: release-please
jobs:
  release-please:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        arch: [amd64, arm64, arm32]
    steps:
      - uses: googleapis/release-please-action@v4
        id: release
        with:
          release-type: go
      - name: Setup Go ${{ matrix.go-version }}
        if: ${{ steps.release.outputs.release_created }}
        uses: actions/setup-go@v5
        with:
          go-version: 1.22.4
      - name: Download go files
        if: ${{ steps.release.outputs.release_created }}
        working-directory: ./setup/
        run: go download
      - name: Build go
        if: ${{ steps.release.outputs.release_created }}
        working-directory: ./setup/
        run: go build -o jelp-$GOOS-$GOARCH
        env:
            GOOS: linux
            GOARCH: ${{ matrix.arch }}
      - name: Upload Release Artifact
        if: ${{ steps.release.outputs.release_created }}
        run: gh release upload ${{ steps.release.outputs.tag_name }} jelp-linux-${{ matrix.arch }}